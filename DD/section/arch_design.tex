\section{Architectural Design}
\subsection{Overview}
The figure shown below represents a high-level description of the components which make up the System.
The architectural design of the System is divided between eMSP and CPMS. \\
The former describes the part of the System dedicated to offer a Web App for
EV Drivers to plan their charges, book a charge and manage the charges. \\
The latter describes the CPMSs used by the CPOs to manage the reservations, the CP, the energy mix and the contracts with the DSOs.
Both the two parts consists of a four tier architecture that can be grouped into three logical layers: presentation, business logic and data.
\begin {enumerate}
\item Presentation Layer: it manages the presentation logic and all the interactions with the end users
\item Business Logic Layer: it manages the application functions that the S2B provide
\item Data Layer: it manages the safe storage and the access to data
\end{enumerate}
\hfill \\
In this document the presentation layer and the Client (e.g. the Browser)
will be referred to as the Frontend, while the Application Layer and the Data Layer
will be referred to as the Backend.

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.42]{src/Overview/overview_diagram.pdf}
\end{figure}

\hfill \\
The service is supposed to be accessed through a web interface.
Since the features offered and the intensity of the interaction with the application server
are very different depending on the type of user, the web interfaces will be developed following
different principles.
For the EV Drivers an SPA will be developed. An SPA is well-suited for applications
that require a lot of interaction and do not need to perform frequent full page reloads.
They can provide a faster and more seamless user experience for applications that require a
lot of interaction.
For the CPO an SSR Dashboard will be developed. SSR can provide a faster user experience
the server pre-renders the content, reducing the amount of work that the client needs to do.
The Overview Architecture of the S2B divides the application in the layers described
above, and contains some replicated Web Servers, which act as a middleware
between the user's browser and the application servers.
Finally, the application servers interfaces with the DBMS APIs, in order
to retrieve and store the data required for the considered computation.
The applications servers are expected to be stateless, according to the
REST standard definitions. The nodes are separated by firewalls to guarantee a higher level of security
of the whole system.

\begin{itemize}
    \item Static Web Server: it does not execute any business logic, but simply receive requests from the client and serve an HTML file along with other static assets (CSS Sheets, JS files, \dots).
          It does not route the request to the Application Server
    \item Web Server: it does not execute any business logic, but simply receive requests from the client, route
          them to the application servers which build the HTML page (along with the static assets) and send it back to the web server which serve the client
\end{itemize}
\pagebreak
\subsection{Component view}
In this section we show the components of the S2B, their relationships and interfaces. The following sections will explain the interaction between interfaces and details on each method of interfaces with REST endpoints, if any.


\subsubsection{eMSP}

\paragraph*{eMSP Web App} \hfill \\
It represents the application dedicated to the different EV drivers using the system.

\paragraph*{eMSP Application Server} \hfill \\
...TODO
\begin{itemize}
    \item \textbf{Account Manager} \\ This component handles all the account operations related to the CPO and offers an interface to authenticate
          the requests in the CPMS application server.
          It offers functionality to create new account, logging in, setting preferences and verify the authentication of the user at any time.
          To create a new account interacts with the external SMS API to make the user receive a code to verify the identity.
    \item \textbf{CP Search} \\ This component handles the operations needed to show the CPs in a specified range of km. Through the GPS service,
          this component has the current latitude and longitude
    \item \textbf{Car Manager} \\
    \item \textbf{Reservation Manager} \\
\end{itemize}


\subsubsection{CPMS}

\paragraph*{CPO Web App} \hfill \\
It represents the application dedicated to the different CPOs using the system. This component contains the logic to receive HTTPS requests from the users' browser,
forward them to the CPMS Application Server, and generate dynamic pages based on the response from the CPMS Application Server.

\paragraph*{CPMS Application Server} \hfill \\
The CPMS Application Server is responsible for the business logic to provide the functionality to the application for the CPOs and to coordinate the information flow between application layer and data layer.
It is composed of several components, each of them used for a specific functionality:\\
\begin{itemize}
    \item \textbf{Reservation Manager} \\
    \item \textbf{Rate Manager} \\
    \item \textbf{Energy Manager} \\
    \item \textbf{Charging Points Manager} \\
    \item \textbf{Account Manager} \\ This component handles all the account operations related to the CPO and offers an interface to authenticate the requests in the CPMS application server.
          It offers functionality to create new account, logging in, setting preferences and verify the authentication of the user at any time.
          To create a new account interacts with the external SMS API to make the user receive a code to verify the identity.
\end{itemize}

\begin{figure}[H]
    \centering
    \hspace*{-1.7cm}
    \includegraphics[height=\textheight-0.1cm,keepaspectratio]{src/ComponentDiagram/component_diagram.pdf}
    \caption{Component Diagram of the eMall System}
\end{figure}

\begin{figure}[H]
    \centering
    \hspace*{-2.5cm}
    \includegraphics[height=\textheight-1.5cm,keepaspectratio]{src/componentInterfaces/component_interface.pdf}
    \caption{Class Diagram with interfaces of the eMall System}
\end{figure}

\subsection{Deployment view}
Infrastructure: deployment diagram(s) including non-logical elements (e.g., load balancer, firewall)

\subsection{Runtime view}
You can use sequence diagrams to describe the way components interact to accomplish specific tasks typically related to your use cases. Dynamics of the interactions: sequence
diagrams (realization of use cases)

\subsection{Component interfaces}
Details for each interface (name, signature, returned objects)
\subsubsection{REST Endpoints}
\renewcommand{\labelitemii}{}
\renewcommand{\labelitemiii}{-}
\begin{itemize}
    \item \texttt{/api/search/<latitude|longitude>}
          \begin{itemize}
              \item Maps: \texttt{NomeMetodoMappato}
              \item Type: TipoAPI(GET,POST)
              \item URL Parameters:
                    \begin{itemize}
                        \item \texttt{<latitude|longitude>} - GPS Location, needed to find CPs nearby a certain location.
                    \end{itemize}
              \item Parameters:
                    \begin{itemize}
                        \item \texttt{authToken}
                        \item \texttt{blabla} [string] - description
                        \item \texttt{blabla} [boolean] - description
                        \item \texttt{blabla} [number] - description
                    \end{itemize}
              \item Success:
                    \begin{itemize}
                        \item 200 - OK + Response
                              \begin{lstlisting}
            {
                "cps": [
                    {
                        "id": "<store id>",
                        "name": "<cp name>",
                        "address": "<address>",
                        "open": <boolean>,
                        "distance": <number>,
                    }
                ]
            }
            \end{lstlisting}
                    \end{itemize}
              \item Errors:
                    \begin{itemize}
                        \item 400 - Bad request
                        \item 404 - No store found
                    \end{itemize}
          \end{itemize}
\end{itemize}

\subsection{Logical Description of Data}
\begin{figure}[H]
    \includegraphics[scale=0.30]{src/ERDiagram/er_diagram.pdf}
\end{figure}

\subsection{Architectural Styles and patterns}
Please explain which styles/patterns you used, why, and how

\begin{itemize}
    \item Three layers and Four Tier: what and why?
    \item RESTful: what and why?
    \item Adapter Pattern: The Query Manager component implements the Adapter pattern, as it mediates between the
          business logic and the DBMS services, exposing only a restricted and higher level set of functionalities.
\end{itemize}
\subsection{Other design decisions}
\subsubsection{PWA}
\dots
\subsubsection{Scale-out}
\dots
\subsubsection{Relational Database}
\dots
\subsubsection{The separation of eMSP and CPMSs}