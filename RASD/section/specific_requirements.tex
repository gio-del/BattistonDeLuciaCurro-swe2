\section{Specific requirements}

\subsection{External Interface Requirements}
In this section are described details about user interfaces, hardware and application programming interfaces.

\subsubsection{User Interfaces}
\begin{figure}[H]
    \subfloat[Details]{
        \includegraphics[scale=0.1]{src/mockups/details.png}
    }
    \subfloat[Booking]{
        \includegraphics[scale=0.1]{src/mockups/book.png}
    }
    \subfloat[Cost detail]{
        \includegraphics[scale=0.1]{src/mockups/book_cost.png}
    }
    \newline
    % following mockups
\end{figure}


\subsubsection{Hardware Interfaces}
To use the system, both EV drivers and CPOs must use a mobile device or a personal computer.
Due to the outdoor expected use of the system, a smartphone will be more suitable device
for a EV driver, instead for a CPO is suggested to use the system from a personal computer.


\subsubsection{Software Interfaces}
The system should relies on various external services accessible via uniform web API. These services are:


\subsubsection{Communication Interfaces}
The system requires a stable internet connection to work properly.
The backend of the system will expose a unified REST compliant API to communicate
with all clients (both CPOs and EV drivers) using HTTPS and TCP/IP.
\\Furthermore, the system relies on various external accessible via uniform web API. These services are:
\begin{itemize}
    \item \textbf{Map Service}: eMall system relies on a map service to get the map and to do operations on the map which is the central component of the application.
    \item \textbf{GPS Service}: eMall system relies on GPS to obtain the location of the user and to show their position on the map
    \item \textbf{DSO Energy Pricing Service}: eMall system use this interface to obtain updated prices of the different DSOs available for the location of the EVCPs. The interface also, permits to select from which DSO acquire energy.
    \item \textbf{EV Service}: eMall system uses this interface that has a register that contains data about all the EVs around the world as the model, the manufacturer, the battery capacity, the efficiency, the range, the connector type and the maximum input power. It is also used to show the battery status of the user's car
    \item \textbf{EVCP Energy Storage System Managing Service}: This interface is used to retrieve data about the energy store system status and the solar panel production and decide how to mix the sources of energy
    \item \textbf{OCPP compliant CP client}: eMall system relies on it to retrieve data or send data to the CPs
    \item \textbf{Calendar OS API}: The interface is used to identify which are the commitments and which are the free slots and suggest proactively when is more convenient to charge
    \item \textbf{Payment Gateway}: eMall system relies on it for processing every payment operation on the application
    \item \textbf{Push Notification Service}: eMall notifications will be sent to update in real time the EV driver that the charging shift will begin shortly, when the charging process has ended and of special offer in nearby CPs
    \item \textbf{SMS Service}: eMall system relies on it to send verification code SMS to customers phones.
\end{itemize}


\subsection{Use cases}

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.6]{src/use_case_diagram/driver_registration.png}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.6]{src/use_case_diagram/cpo_registration.png}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{src/use_case_diagram/cpo.png}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.6]{src/use_case_diagram/driver.png}
\end{figure}


\usecase
{1}
{EV driver registration}
{EV driver, SMS Service}
{EV driver clicks 'Sign Up' in the application homepage}
{
    \begin{enumerate}
        \item The system sends user the registration form
        \item Driver enters name, surname, birth date, telephone number and password. Then submits the data upon reading and accepting the Privacy Policy and the Terms of Service
        \item The system calls SMS Service API to send to the driver an SMS containing a secret code
        \item The SMS Service sends the SMS to the driver
        \item The driver submits the received verification code
        \item The system verifies the code and displays a success message
    \end{enumerate}
}
{A new EV driver account is created}
{
    \begin{itemize}
        \item A required registration field is missing when the form is submitted
        \item A wrong verification code is submitted
        \item The timeout of verification expires
        \item Loss of internet connection
        \item The actor cancels the operation
    \end{itemize}
}
{
    All the exception are treated the same: the system will notify user with a human-readable message and the user is redirected to the homepage
}


\usecase
{2.1}
{Map filtering by date}
{EV driver, Map Service}
{EV driver is in the map page}
{
    \begin{enumerate}
        \item Driver selects a date from the search bar calendar
        \item The system filters the CPs that have at least one available spot in the provided date and calls the Map Service
        \item The Map Service updates the map
    \end{enumerate}
}
{The filtered markers are displayed}
{
    \begin{itemize}
        \item The provided date is before the actual date of searching
    \end{itemize}
}
{
    The system shows an error and the map as it was
}

\usecase
{2.2}
{Map filtering by connector}
{EV driver, Map Service}
{EV driver is in the map page}
{
    \begin{enumerate}
        \item Driver selects a list of connectors from the search bar connector dropdown
        \item The system filters the CPs that have at least one available spot with one of the chosen connectors and calls the Map Service
        \item The Map Service updates the map
    \end{enumerate}
}
{The filtered markers are displayed}
{
    No exception in this use case
}
{
}

\usecase
{2.3}
{Map filtering by location}
{EV driver, Map Service, GPS Service}
{EV driver is in the map page}
{
    \begin{enumerate}
        \item Driver specifies an address where to search for CPs or their current position
        \item The system shows the CPs that are nearby the specified address and calls the Map Service
        \item The Map Service updates the map
    \end{enumerate}
}
{The filtered markers are displayed}
{
    \begin{itemize}
        \item The result of geolocalization of the specified address is not defined
    \end{itemize}
}
{
    The system shows an error and the map as it was
}

\usecase
{3}
{Get details of an EVCP}
{EV driver}
{EV driver is in the map page}
{
    \begin{enumerate}
        \item Driver selects a marker representing an EVCP on the map
        \item The system shows the details of the EVCP associated to the marker
    \end{enumerate}
}
{A page with EVCP details is shown}
{
    No exception in this use case
}
{
}

\usecase
{4}
{Book a charge}
{EV driver, Payment Gateway}
{Authenticated EV driver is in the EVCP details page}
{
    \begin{enumerate}
        \item User clicks 'Book a Charge' button or one among the 'Now' buttons related to connector types (if available)
        \item The system show a booking page containing a form with connector, date and time frame selection
        \item User fills the form and clicks 'Book' button
        \item The system processes the information and redirects the user to the payment gateway interface
        \item The Payment Gateway sends user a payment form
        \item The user fills the form with payment information and clicks 'Confirm'
        \item The Payment Gateway processes the information and notify the system
        \item The System processes the information and show a success message redirecting the user to the reservation tab
    \end{enumerate}
}
{The spot is booked and the transaction is successfully executed}
{
    \begin{itemize}
        \item At least one of the inserted booking data is not valid
        \item The payment gateway return an invalid payment
    \end{itemize}
}
{
    First Exception: the system shows an error and redirect user to EVCP details page
    Second Exception the system shows an error during the payment process and asks to retry
}

\usecase
{5}
{Start a charge}
{EV driver, OCPP Compliant CP client}
{Authenticated EV driver is in the reservation page}
{
    \begin{enumerate}
        \item The system shows all the reservations with the "pending" reservation in evidence
        \item User clicks the button 'Start' in the reservation in evidence to start the charge
        \item The system receives the input and activates the CP through the OCPP protocol
        \item The CP acknowledges the system that its status has changed from "reserved" to "charging"
        \item The system changes the status of the reservation in "running"
    \end{enumerate}
}
{The charging is started}
{
    \begin{itemize}
        \item At least one of the inserted data is not valid
    \end{itemize}
}
{
    The system shows an error asking to retry
}

\usecase
{6}
{Personalize experience by inserting car details}
{EV driver, EV Service}
{Authenticated EV driver is in homepage}
{
    \begin{enumerate}
        \item The user ask the car view
        \item The system shows user the car page
        \item The user clicks 'Add an EV' button
        \item The system ask EV Service an updated list of EV then shows it to user
        \item The user select one of the EV and connects the personal EV to the EV Service API
        \item The system processes the information and shows a success message
    \end{enumerate}
}
{The user has inserted car details}
{
    No exception in this use case
}
{
}

\usecase
{7}
{Get history of reservations}
{EV driver}
{Authenticated EV driver is in the home page}
{
    \begin{enumerate}
        \item The user switch to the reservation tab
        \item The system shows a page with a list of past reservations and active ones
    \end{enumerate}
}
{A list of reservations is shown}
{
    No exception in this use case
}
{
}

\usecase
{8}
{Get details of the current charge}
{EV driver, OCPP Compliant CP Client}
{Authenticated EV driver is in the car tab}
{
    \begin{enumerate}
        \item The system asks the CP, through OCPP, the details of the current charge of the user
        \item The CP replies, through OCPP, with CDR
        \item The system shows all the details of the current charge
    \end{enumerate}
}
{The details of the current charge are shown}
{
    No exception in this use case
}
{
}

\usecase
{9}
{Delete a reservation}
{EV driver}
{Authenticated EV driver is in reservation tab}
{
    \begin{enumerate}
        \item The system shows a list with all the "not started" reservation
        \item User selects a reservation and click the associtated button
        \item The system receives the input and shows details on the selected reservation
        \item User clicks "delete" button in current reservation
        \item The system displays a success message
    \end{enumerate}
}
{The user has deleted a reservation}
{
    \begin{itemize}
        \item At least one of the inserted data is not valid
    \end{itemize}
}
{
    The system shows an error asking to retry
}


\usecase
{10}
{CPO registration} % name
{CPO} % actor
{CPO clicks 'Sign Up' in the business dedicated application homepage} % entry condition
{ % event flow
    \begin{enumerate}
        \item The system sends operator the registration form
        \item Operator enters company name, VAT, IBAN, and password. Then submits the data upon reading and accepting the Privacy Policy and the Terms of Service
        \item The system processes the provided information and display a success message
    \end{enumerate}
}
{A new operator account is created} % exit condition
{ % exceptions
    \begin{itemize}
        \item A required registration field is missing when the form is submitted
        \item The operator is not associated to the given VAT
        \item Loss of internet connection
        \item The actor cancels the operation
    \end{itemize}
}
{ % notes
    All the exception are treated the same: the system will notify operator with a human-readable message and the operator is redirected to the homepage
}

\usecase
{11}
{Check energy in batteries} % name
{CPO} % actor
{Authenticated CPO is in "Monitor status of EVCP" tab} % entry condition
{ % event flow
    \begin{enumerate}
        \item The operator choose a specific EVCP and clicks 'check energy in batteries'
        \item The system shows the battery status of the selected EVCP, if any
    \end{enumerate}
}
{The 'Check energy in batteries' chart is shown} % exit condition
{ % exceptions
    \begin{itemize}
        \item Loss of internet connection
        \item The actor cancels the operation
    \end{itemize}
}
{ % notes
    ...
}

\usecase
{12}
{Monitor specific charging process} % name
{CPO} % actor
{Authenticated CPO is in "Monitor status of CP" tab} % entry condition
{ % event flow
    \begin{enumerate}
        \item The operator choose a specific EVCP and clicks "monitor specific charging process"
        \item The system shows a list of active charging process and ask operator to choose one
        \item The operator choose a specific active charging process from the list
        \item The system shows the details of the chosen charging process
    \end{enumerate}
}
{The details of the specific charging process are displayed} % exit condition
{ % exceptions
    \begin{itemize}
        \item Loss of internet connection
        \item The actor cancels the operation
    \end{itemize}
}
{ % notes
    ...
}

\usecase
{13}
{Monitor aggregate charging process} % name
{CPO} % actor
{Authenticated CPO is in "Monitor status of CP" tab} % entry condition
{ % event flow
    \begin{enumerate}
        \item The operator choose a specific EVCP and clicks "monitor aggregate charging process"
        \item The system shows a chart with a detailed view of aggregate charging processes
    \end{enumerate}
}
{The aggregate charging process details charts are displayed} % exit condition
{ % exceptions
    \begin{itemize}
        \item Loss of internet connection
        \item The actor cancels the operation
    \end{itemize}
}
{ % notes
    ...
}

\usecase
{14}
{View historical reservations} % name
{CPO} % actor
{Authenticated CPO is in "View reservations" tab} % entry condition
{ % event flow
    \begin{enumerate}
        \item The operator choose a specific EVCP, choose "historical reservation" tab, and sets a specific time frame
        \item The system shows the reservation details of the chosen EVCP during the chosen time frame
    \end{enumerate}
}
{The details of the historical reservations are displayed} % exit condition
{ % exceptions
    \begin{itemize}
        \item Loss of internet connection
        \item The actor cancels the operation
    \end{itemize}
}
{ % notes
    ...
}

\usecase
{15}
{View active reservations} % name
{CPO} % actor
{Authenticated CPO is in "View reservations" tab} % entry condition
{ % event flow
    \begin{enumerate}
        \item The operator choose a specific EVCP, choose "active reservation" tab
        \item The system shows a list of active reservation for the chosen EVCP
    \end{enumerate}
}
{The details of the active reservations are displayed} % exit condition
{ % exceptions
    \begin{itemize}
        \item Loss of internet connection
        \item The actor cancels the operation
    \end{itemize}
}
{ % notes
    ...
}

\usecase
{16}
{Choose DSO} % name
{CPO} % actor
{Authenticated CPO is in "Manage CPs" tab} % entry condition
{ % event flow
    \begin{enumerate}
        \item The operator choose a specific EVCP, choose "Choose DSO" tab
        \item The system provides a list of available DSOs
        \item The operator select one DSO among the available ones and submit their choice to the system
        \item The system processes the provided information and display a success message
    \end{enumerate}
}
{The choice of DSO is completed} % exit condition
{ % exceptions
    \begin{itemize}
        \item Loss of internet connection
        \item The actor cancels the operation
    \end{itemize}
}
{ % notes
    ...
}

\usecase
{17}
{Choose energy mix} % name
{CPO} % actor
{Authenticated CPO is in "Manage CPs" tab} % entry condition
{ % event flow
    \begin{enumerate}
        \item The operator choose a specific EVCP, choose "Choose energy mix" tab
        \item The system provides a list of available energy storing mode (maximize energy in battery, maximize self consumption, time of battery use)
        \item The operator select one source of energy among the available ones and submit their choice to the system
        \item The system process the provided informations and sets the chosen mode
    \end{enumerate}
}
{The choice of an EVCP energy storing mode is completed} % exit condition
{ % exceptions
    \begin{itemize}
        \item Loss of internet connection
        \item The actor cancels the operation
    \end{itemize}
}
{ % notes
    ...
}

\usecase
{18}
{Retrieve price of energy} % name
{CPO} % actor
{Authenticated CPO is in "Manage CPs" tab} % entry condition
{ % event flow
    \begin{enumerate}
        \item The operator choose a specific EVCP, choose "Retrieve price of energy" tab
        \item The system provides a list of prices of sources of energy from different DSOs
    \end{enumerate}
}
{The details of price energy are displayed} % exit condition
{ % exceptions
    \begin{itemize}
        \item Loss of internet connection
        \item The actor cancels the operation
    \end{itemize}
}
{ % notes
    ...
}

\usecase
{19}
{Change Status of a CP} % name
{CPO} % actor
{Authenticated CPO is in "Manage CPs" tab} % entry condition
{ % event flow
    \begin{enumerate}
        \item The operator choose a specific EVCP, choose "Change Status of a CP" tab
        \item The system provides a page on which the operator can set a specific time frame in which the operator wants to change the status of a specific CP
        \item The operator sets a specific time frame
        \item The system processes the provided information and display a success message
    \end{enumerate}
}
{The change of status of the specific CP has been planned} % exit condition
{ % exceptions
    \begin{itemize}
        \item Loss of internet connection
        \item The actor cancels the operation
    \end{itemize}
}
{ % notes
    ...
}

\subsection{Functional Requirements}


\subsubsection{CPO Functional Requirements}
\begin{table}[H]
    \begin{tabularx}{\textwidth}{cX}
        \toprule
        \textbf{R1}  & The system must allow unregistered operator to register an account                                                                                       \\
        \textbf{R2}  & The system must allow authenticated CPOs making a special offer on their CPs prices                                                                      \\
        \textbf{R3}  & The system must allow authenticated CPOs monitoring the charging process to infer when the battery is full                                               \\
        \textbf{R4}  & The system must allow authenticated CPOs retrieving the amount of energy available in their EVCPs batteries                                              \\
        \textbf{R5}  & The system must allow authenticated CPOs retrieving the number of vehicle being charged in their EVCPs and for each vehicle the amount of absorbed power \\
        \textbf{R6}  & The system must allow authenticated CPOs retrieving the remaining charge time for each connected vehicle                                                 \\
        \textbf{R7}  & The system must allow authenticated CPOs retrieving details on active and historical reservations on their EVCPs                                         \\
        \textbf{R8}  & The system must allow authenticated CPOs acquiring information from the DSOs about the current price of energy                                           \\
        \textbf{R9}  & The system must allow authenticated CPOs deciding from which DSO to acquire energy from                                                                  \\
        \textbf{R10} & The system must dynamically decide where to get energy for charging (electrical grid, battery or a mixture)                                              \\
        \textbf{R11} & The system must allow authenticated CPOs statically deciding where to get energy for charging (electrical grid, battery or a mixture)                    \\
        \textbf{R12} & The system must allow authenticated CPOs adding, modifying and deleting CPs                                                                              \\
        \textbf{R13} & The system must allow authenticated CPOs changing availability status of their CPs                                                                       \\
        \bottomrule
    \end{tabularx}
\end{table}
\subsubsection{eMSP Functional Requirements}
\begin{table}[H]
    \begin{tabularx}{\textwidth}{cX}
        \toprule
        \textbf{R14} & The system must allow unregistered users to register an account                                                   \\
        \textbf{R15} & The system must allow registered users to login                                                                   \\
        \textbf{R16} & The system must allow authenticated users to personalize their experience by providing information of their EV    \\
        \textbf{R17} & The system must allow users to search for CPs in the map                                                          \\
        \textbf{R18} & The system must show to the users CPs nearby their current position                                               \\
        \textbf{R19} & The system must allow retrieving details on a given CP regarding connector types supported and cost of the charge \\
        \textbf{R20} & The system must allow authenticated user to book a CP for a certain time interval                                 \\
        \textbf{R21} & The system must allow booking a CP if and only if it is free for the specified time interval                      \\
        \textbf{R22} & The system must notify users when the charging shift is about to start                                            \\
        \textbf{R23} & The system must allow authenticated users to start the charge                                                     \\
        \textbf{R24} & The system must suggest users when to charge based on daily schedule, special offers and availability             \\
        \textbf{R25} & The system must allow authenticated users to monitor the charging status                                          \\
        \textbf{R26} & The system must notify authenticated users when the charging process is completed                                 \\
        \textbf{R27} & The system must allow authenticated users to pay for the charge                                                   \\
        \textbf{R28} & The system must allow authenticated users to delete a reservation                                                 \\
        \textbf{R29} & The system must allow authenticated users to view historical reservations                                         \\ \bottomrule
    \end{tabularx}
\end{table}

\subsubsection{Mapping on goals}
\begin{table}[H]
    \begin{tabularx}{\textwidth}{XXX}
        \toprule
        \textbf{Goal} & \textbf{Requirements} & \textbf{Assumptions} \\ \midrule
        G1            & R1,R2,R3              & D1,D2,D3             \\
        G2            & esempio               & esempio              \\
        G3            & esempio               & esempio              \\ \bottomrule
    \end{tabularx}
\end{table}
\subsubsection{Mapping on use cases}
\begin{table}[H]
    \begin{tabularx}{\textwidth}{XXX}
        \toprule
        \textbf{Goal} & \textbf{Requirements} & \textbf{Assumptions} \\ \midrule
        U1            & R1,R2,R3              & D1,D2,D3             \\
        U2            & esempio               & esempio              \\
        U3            & esempio               & esempio              \\ \bottomrule
    \end{tabularx}
\end{table}

\subsection{Performance Requirements}
The requirements of the system are not critical, so these performance requirements
are focus on guarantee the best of possible experience to both EV drivers and CPOs.
To do that, the system should provide:
\begin{itemize}
    \item a scalable, reactive and load-balancing backend
    \item the visualization of the map in 5 seconds, or less;
    \item the list of active and historical reservations in less than 5 seconds;
    \item the booking confirmation in 7 seconds, or less;
    \item the loading of the available time slots for a specific charging point in less than 5 seconds;
    \item push app notification with a delay that is imperceptible to the user.
    \item Notice that a good internet connection is assumed in the previous estimations.
\end{itemize}

\subsection{Design Constraints}


\subsubsection{Standards compliance}
Specifications described in this document must be respected by the system.
Source code of the application must be commented on and documented adequately.
The system should respect the line guides described by the European GDPR.

\subsubsection{Hardware limitations}
The system requires any device and a stable internet connection.

\subsection{Software System Attributes}

\subsubsection{Availability and Reliability}
The system should offer its functionalities with an availability
equal to 99.5, or more. In other words, the system must be inaccessible
for less than two days every year. To achieve this goal, the system should
provide a high redundancy for the most critical components.
Furthermore, in order to guarantee better reliability performances, all
the scheduled maintenance intervents on the system should be done during
the night.

\subsubsection{Security}
The connection between the application and the server must be safe.
System use the TLS (Transport Layer Security) protocol.
To do that for this purpose, it is needed an SSL/TSL certificate.
Moreover, all passwords must be encrypted

\subsubsection{Maintainability}
Source code and correlated documentation must be commented and kept updated.
Modularity, low coupling and high cohesion between components must be a focus during the
designing and developing phases.

\subsubsection{Portability}
The system is a web application so it will be supported by any device with
a modern browser.